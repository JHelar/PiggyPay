// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: transactions.sql

package generated

import (
	"context"
)

const createMemberTransaction = `-- name: CreateMemberTransaction :exec
INSERT INTO group_member_transactions (from_receipt_id, to_receipt_id, state, amount) VALUES (?, ?, ?, ?)
`

type CreateMemberTransactionParams struct {
	FromReceiptID int64   `json:"from_receipt_id"`
	ToReceiptID   int64   `json:"to_receipt_id"`
	State         string  `json:"state"`
	Amount        float64 `json:"amount"`
}

func (q *Queries) CreateMemberTransaction(ctx context.Context, arg CreateMemberTransactionParams) error {
	_, err := q.db.ExecContext(ctx, createMemberTransaction,
		arg.FromReceiptID,
		arg.ToReceiptID,
		arg.State,
		arg.Amount,
	)
	return err
}

const getUserGroupTransaction = `-- name: GetUserGroupTransaction :one
SELECT 
    group_member_transactions.from_receipt_id AS from_receipt_id,
    group_member_transactions.to_receipt_id AS to_receipt_id, 
    group_member_transactions.state AS transaction_state, 
    group_member_transactions.amount AS transaction_amount,
    to_users.first_name AS to_first_name,
    to_users.last_name AS to_last_name,
    to_users.phone_number as to_phone_number
    FROM group_member_transactions
    INNER JOIN group_member_receipts from_receipts
        ON group_member_transactions.from_receipt_id=from_receipts.id
    INNER JOIN group_member_receipts to_receipts
        ON group_member_transactions.to_receipt_id=to_receipts.id
    INNER JOIN users to_users
        ON to_users.id=from_receipts.user_id
    WHERE
        group_member_transactions.id=?
        AND from_receipts.user_id=?
        AND from_receipts.group_id=?
`

type GetUserGroupTransactionParams struct {
	ID      int64 `json:"id"`
	UserID  int64 `json:"user_id"`
	GroupID int64 `json:"group_id"`
}

type GetUserGroupTransactionRow struct {
	FromReceiptID     int64   `json:"from_receipt_id"`
	ToReceiptID       int64   `json:"to_receipt_id"`
	TransactionState  string  `json:"transaction_state"`
	TransactionAmount float64 `json:"transaction_amount"`
	ToFirstName       string  `json:"to_first_name"`
	ToLastName        string  `json:"to_last_name"`
	ToPhoneNumber     string  `json:"to_phone_number"`
}

func (q *Queries) GetUserGroupTransaction(ctx context.Context, arg GetUserGroupTransactionParams) (GetUserGroupTransactionRow, error) {
	row := q.db.QueryRowContext(ctx, getUserGroupTransaction, arg.ID, arg.UserID, arg.GroupID)
	var i GetUserGroupTransactionRow
	err := row.Scan(
		&i.FromReceiptID,
		&i.ToReceiptID,
		&i.TransactionState,
		&i.TransactionAmount,
		&i.ToFirstName,
		&i.ToLastName,
		&i.ToPhoneNumber,
	)
	return i, err
}

const getUserGroupTransactions = `-- name: GetUserGroupTransactions :many
SELECT 
    group_member_transactions.id AS transaction_id,
    group_member_transactions.from_receipt_id AS from_receipt_id,
    group_member_transactions.to_receipt_id AS to_receipt_id, 
    group_member_transactions.state AS transaction_state, 
    group_member_transactions.amount AS transaction_amount,
    to_users.first_name AS to_first_name,
    to_users.last_name AS to_last_name,
    to_users.phone_number as to_phone_number
    FROM group_member_transactions
    INNER JOIN group_member_receipts from_receipts
        ON group_member_transactions.from_receipt_id=from_receipts.id
    INNER JOIN group_member_receipts to_receipts
        ON group_member_transactions.to_receipt_id=to_receipts.id
    INNER JOIN users to_users
        ON to_users.id=to_receipts.user_id
    WHERE
        from_receipts.user_id=?
        AND from_receipts.group_id=?
`

type GetUserGroupTransactionsParams struct {
	UserID  int64 `json:"user_id"`
	GroupID int64 `json:"group_id"`
}

type GetUserGroupTransactionsRow struct {
	TransactionID     int64   `json:"transaction_id"`
	FromReceiptID     int64   `json:"from_receipt_id"`
	ToReceiptID       int64   `json:"to_receipt_id"`
	TransactionState  string  `json:"transaction_state"`
	TransactionAmount float64 `json:"transaction_amount"`
	ToFirstName       string  `json:"to_first_name"`
	ToLastName        string  `json:"to_last_name"`
	ToPhoneNumber     string  `json:"to_phone_number"`
}

func (q *Queries) GetUserGroupTransactions(ctx context.Context, arg GetUserGroupTransactionsParams) ([]GetUserGroupTransactionsRow, error) {
	rows, err := q.db.QueryContext(ctx, getUserGroupTransactions, arg.UserID, arg.GroupID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetUserGroupTransactionsRow{}
	for rows.Next() {
		var i GetUserGroupTransactionsRow
		if err := rows.Scan(
			&i.TransactionID,
			&i.FromReceiptID,
			&i.ToReceiptID,
			&i.TransactionState,
			&i.TransactionAmount,
			&i.ToFirstName,
			&i.ToLastName,
			&i.ToPhoneNumber,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const payUserGroupTransaction = `-- name: PayUserGroupTransaction :one
UPDATE group_member_transactions
SET state=?1,payed_at=CURRENT_TIMESTAMP
WHERE id=(
        SELECT group_member_transactions.id FROM group_member_transactions
            INNER JOIN group_member_receipts
                ON group_member_receipts.id=group_member_transactions.from_receipt_id
            WHERE 
                group_member_receipts.user_id=?2 
                AND group_member_receipts.group_id=?3
                AND group_member_transactions.id=?4
                AND group_member_transactions.state=?5
    )
RETURNING id, from_receipt_id, to_receipt_id, state, amount, created_at, payed_at
`

type PayUserGroupTransactionParams struct {
	ToState       string `json:"to_state"`
	UserID        int64  `json:"user_id"`
	GroupID       int64  `json:"group_id"`
	TransactionID int64  `json:"transaction_id"`
	FromState     string `json:"from_state"`
}

func (q *Queries) PayUserGroupTransaction(ctx context.Context, arg PayUserGroupTransactionParams) (GroupMemberTransaction, error) {
	row := q.db.QueryRowContext(ctx, payUserGroupTransaction,
		arg.ToState,
		arg.UserID,
		arg.GroupID,
		arg.TransactionID,
		arg.FromState,
	)
	var i GroupMemberTransaction
	err := row.Scan(
		&i.ID,
		&i.FromReceiptID,
		&i.ToReceiptID,
		&i.State,
		&i.Amount,
		&i.CreatedAt,
		&i.PayedAt,
	)
	return i, err
}
